# Akari Math Lab – さくらのレンタルサーバー向けポートフォリオ

数学科学生 Akari の活動を紹介するポートフォリオサイトです。静的 HTML と PHP で構成し、さくらのレンタルサーバー（ライトプラン）での運用に最適化しています。ホームと About は静的ページ、Diary は簡易パスワード付きの PHP アプリで投稿・削除ができます。

## リポジトリ構成

- `docs/index.html` – トップページ。静的 HTML として配信。
- `docs/about/index.html` – About ページ。
- `docs/diary/index.php` – 日記の投稿・編集・削除を扱う PHP ページ。`docs/data/diary_entries.json` に投稿を保存。MathJax、フォルダー（カテゴリー）分け、タグ付け、検索、並び替え（新しい順 / 古い順 / タイトル順）に対応しています。
- `docs/diary/show.php` – 日記 1 件を表示する詳細ページ。共有リンク、コメント、いいねを個別に確認できます。
- `docs/diary/edit.php` – 個別投稿の編集専用ページ。落ち着いて本文やタグを更新できます（検索には載せない場合、sitemap から除外してください）。
- `docs/diary/folder.php` – 指定フォルダーの投稿を別ページとして表示。URL 形式は `diary/folder.php?name=フォルダー名`。
- `docs/robots.txt`, `public/robots.txt`, `docs/sitemap.php` – 検索エンジン向けのクローラ設定とサイトマップ。運用ドメインに合わせて URL を更新してください。
- `docs/assets/` – 共通スタイル (`application.css`) とアイコン。
- `docs/uploads/` – 日記本文から参照する画像置き場。`../uploads/ファイル名` で読み込めます。
- `docs/resources/index.php` – PDF 公開用ページ。`docs/resources/files/` に配置した PDF を自動で一覧表示します。
- `docs/.htaccess` – さくらでの環境変数、CSP、X-Frame-Options を定義。
- `docs/data/.gitkeep` – 投稿データを保存するディレクトリを保持。
- `config/portfolio/*.yml`, `app/` 以下 – 元の Rails プロジェクト。ローカルで編集を支援したい場合に利用できます。

## さくらのレンタルサーバーへのデプロイ手順

1. ローカルで `docs/` ディレクトリ全体を確認します。`docs/data/` が存在していること、`docs/.htaccess` にパスワードやヘッダ設定が記載されていることをチェックしてください。
2. さくらのサーバー側で `docs/data` に書き込み権限を付与します（FTP クライアントで属性変更、またはサーバーパネルから設定）。
3. `docs/` 以下をサーバーの公開ディレクトリ（例: `~/www/`）へ丸ごとアップロードします。
4. ブラウザで `https://<あなたのドメイン>/docs/` にアクセスし、トップページと `diary/index.php` を確認します。
5. 初回アクセス時に日記の投稿・削除ができるかテストし、`docs/data/diary_entries.json` が生成されるかを確認します。

## パスワードとセキュリティヘッダの設定

- 日記の投稿パスワードは `docs/.htaccess` の `SetEnv DIARY_POST_PASSWORD '@Koutya062525!akar1'` で指定しています。サーバー側で変更したい場合は値を書き換えてアップロードしてください。
- 同ファイルで `Content-Security-Policy` と `X-Frame-Options` を設定しています。必要に応じて許可するドメインを追加してください。
- `.htaccess` が無効なプランでは PHP 冒頭の `DEFAULT_DIARY_PASSWORD` を直接変更して運用します。

## 既存ページの編集

### トップページ `docs/index.html`
1. 任意のエディタで `docs/index.html` を開き、本文を修正します。
2. ナビゲーション内のリンクを変更した場合は、`docs/about/index.html` や `docs/diary/index.php` 内のフッターなども同様に更新してください。
3. スタイルを調整したい場合は `docs/assets/application.css` を編集します。編集後はブラウザキャッシュをクリアして反映を確認してください。

### About ページ `docs/about/index.html`
1. `docs/about/index.html` を編集します。構造はトップページと同様の CSS を共有しています。
2. 画像やアイコンを追加したい場合は `docs/assets/` にファイルを置き、相対パスで参照します。

### Diary ページの本文テキスト
`docs/diary/index.php` 内の説明文（HTML 部分）を直接編集します。PHP ロジックより下にある説明文やラベルを調整することで、フォームの文言を変更できます。本文には MathJax を利用できるため、`\( \alpha \)` や `\[ E = mc^2 \]` のような LaTeX 記法を書けばブラウザ上でレンダリングされます。フォルダー名はテキスト入力で新規追加でき、既存のフォルダーはプルダウンやボタンから選択できます。

#### HTML コンテンツと画像
- HTML タグをそのまま本文に記述すると、許可されたタグだけが安全に出力されます（`<p>`, `<a>`, `<img>` など）。
- 画像は `docs/uploads/` にファイルを追加し、本文では `<img src="../uploads/ファイル名.jpg" alt="説明">` のように記述します。相対パスまたは https:// で始まる URL、`data:image/` のみ許可されます。
- 危険な JavaScript やイベント属性は自動的に除去されます。

#### フォルダー別ページ
- 任意のフォルダーは `diary/folder.php?name=フォルダー名` で閲覧できます。Diary の一覧や投稿本文に表示されるフォルダー名・タグをクリックすると自動的に遷移します。
- フォルダー専用ページでも検索・タグ絞り込み・並び替えが利用できます。

### 検索・タグ・並び替え
- 一覧上部の検索ボックスに入力すると、タイトル・本文・タグを横断して絞り込みます。
- フォルダー（カテゴリー）をドロップダウンやボタンから選ぶと、そのフォルダーに属する投稿だけを表示できます。新しいフォルダーを作る場合は投稿フォームで名前を入力するだけで追加されます。
- プルダウンで「新しい順 / 古い順 / タイトル順」を切り替えられます。
- 投稿フォームの「タグ (カンマ区切り)」でタグを設定すると、一覧にボタンとして表示され、クリックするだけでタグ検索できます。
- 各日記の「編集」リンクから内容を修正できます。編集時も投稿パスワードの入力が必要です。

### いいね・共有・コメント
- 各投稿に「いいね」ボタンが表示され、ブラウザ単位で 1 回だけ押せます（ローカルストレージで管理）。いいね数はサーバー側の JSON に蓄積されます。
- Twitter / Facebook への共有ボタンを備えているため、投稿ごとの URL を簡単に共有できます。
- コメントフォームから誰でもコメント可能です（モデレーションが必要な場合は `docs/data/diary_entries.json` を直接編集してください）。コメントは本文に HTML を解釈せず、改行を保持したテキストとして保存されます。

## 公開用 PDF ページの使い方

- `docs/resources/files/` に PDF を置くと、`docs/resources/index.php` に自動で一覧表示されます。ファイル名・サイズ・更新日が表示され、クリックでダウンロード可能です。
- 各資料にはブラウザ単位で 1 回だけ押せる「いいね」ボタンと Twitter / Facebook の共有リンク、誰でも投稿できるコメント欄を備えています。リアクションは `docs/data/resources_meta.json` に保存されるため、必要に応じてバックアップを取得してください。
- リンク切れを防ぐため、PDF を更新するときは同名ファイルを差し替えるか、README に記載した説明と一致するようにしてください。

## 画像・PDF の配置先

- 画像: `docs/uploads/`（Git には `.gitkeep` のみを含め、実ファイルは必要に応じて追加してください）。
- PDF: `docs/resources/files/`（同じく `.gitkeep` のみを追跡対象にしています）。同名の `.txt` または `.md` を置くとダウンロードボタン下に説明文が表示されます（例: `example.pdf` と `example.txt`）。
- それぞれ `.gitignore` でディレクトリ配下の実ファイルを無視するため、デプロイ時にはアップロードを忘れないよう注意してください。

## 新しいページの追加方法

1. **ディレクトリと HTML を作成**  
   `docs/` 直下に新しいディレクトリ（例: `research/`）を作成し、その中に `index.html` を配置します。`docs/about/index.html` をコピーして内容を書き換えるとレイアウトを簡単に流用できます。

2. **スタイルの適用**  
   `<head>` 内で `../assets/application.css` を読み込むようにリンクを書き換えます。必要なら追加用の CSS を別ファイルで作り、`docs/assets/` に保存します。

3. **ナビゲーション更新**  
   トップページと対象ページ両方のナビゲーションに新しいリンクを追加します。ページ数が増える場合はフッターのリンクも忘れず更新してください。

4. **サーバーへアップロード**  
   新しく追加したディレクトリと更新した HTML / CSS をアップロードし、ブラウザで表示を確認します。

## Diary データの管理

- 投稿内容はサーバー上の `docs/data/diary_entries.json` に JSON 形式で保存されます。Git の追跡対象外なので、定期的にダウンロードしてバックアップを取ることを推奨します。
- 投稿・削除は PHP 内でファイルロックを行っていますが、複数人が同時編集する場合は競合が発生する可能性があります。運用人数に応じてローテーションやバックアップを計画してください。

## Rails 環境について（任意）

このリポジトリには元となった Rails プロジェクトが含まれています。YAML 管理や Stimulus を使った開発環境を再利用したい場合は、以下の通りセットアップできます。

```bash
bundle install
bin/rails db:prepare
bin/rails server
```

Rails 上でデザインやコピーを編集した後、`docs/` に手動で書き戻すことで静的サイト側へ反映する運用も可能です。ただし、現在の本番運用は `docs/` ディレクトリだけで完結します。

## ライセンス

このリポジトリは MIT ライセンスで公開しています。
